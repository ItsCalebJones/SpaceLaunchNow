INTERNAL BUILD
Improved filtering logic.